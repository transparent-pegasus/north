# 実装計画: リサーチソースの手動追加機能とモバイルUI改善

## 概要
ユーザーからのフィードバックに基づき、リサーチ機能の強化（ソースの手動追加）と、モバイル環境（狭い画面）におけるUI/UXの改善を行う。

## 変更内容

### 1. リサーチ機能の強化
- **目的**: ユーザーが独自の情報ソースを明示的に指定してリサーチを行えるようにする。
- **変更点**:
  - `ResearchSpec` 型定義の更新（必要であれば）。現在は `source` が `SourceType` (enum) だが、ここへの介入が必要か検討。
    - 現状の `SourceType` は固定リスト。手動追加とは「既存リストから選択」ではなく「URLなどを直接入力」あるいは「既存リスト外のソースを指定」する意図か確認が必要。
    - *補足*: `todo.md` の「『リサーチ結果』を『情報ソース』にし、手動で追加可能にする」という記述から、単に検索エンジンを選ぶだけでなく、具体的なURLやドキュメントをソースとして登録できる、あるいは検索結果として得られたリストにユーザーが手動で項目を追加できる機能と推測される。ここでは「検索結果リストへの手動追加」と仮定して進める。
  - **Backend**:
    - リサーチ結果保存用API (`/api/research` 関連) の改修。
    - ユーザー入力データを受け付けるバリデーション追加。
  - **Frontend**:
    - `ResearchPanel` または `ResearchModal` に「手動で結果を追加」ボタンを配置。
    - タイトル、URL、スニペット入力フォームの実装。

### 2. モバイルUIの改善
- **目的**: 狭い画面での操作性と閲覧性を向上させる。
- **変更点**:
  - **ヘッダー**:
    - 縦幅を縮小し、コンテンツ領域を確保。
  - **ナビゲーション**:
    - 現在の画面上部や散らばっている操作系（ツリーリスト表示、追加、削除など）を画面下部の「固定ナビゲーションバー」に集約。
    - アイコンベースのデザインに変更。
  - **レイアウト**:
    - コンテンツ最下部にパディングを追加し、固定ナビゲーションバーがコンテンツを隠さないように調整。
  - **テキスト表示**:
    - 「ノードをタップして...」の案内メッセージが、横幅が十分ある場合は折り返されないようにスタイル調整。

### 3. 本番環境設定・認証周りの調査・修正
- **目的**: 本番環境でのGoogleログインの不具合解消と、環境変数管理の適正化。
- **変更点**:
  - **Googleログイン**: 本番環境で失敗する原因を調査・修正（Firebase Auth設定、ドメイン許可、APIキー制限など）。
  - **環境変数管理**:
    - SecretでないFirebase設定（API Key, Project ID等）を本番用に切り替える方法を確立する。
    - `.env.production` 等のファイル管理またはFirebase Hostingのconfig設定などの調査・適用。

## タスクリスト

### Phase 1: モバイルUI改善 (Frontend)
- [ ] `components/BottomNavigation.tsx` の新規作成。
- [ ] `app/layout.tsx` または `app/page.tsx` へのナビゲーション配置とレイアウト調整（`pb-xx` 追加）。
- [ ] `TitleScreen.tsx` や既存ヘッダーコンポーネントのスタイル調整（高さ縮小）。
- [ ] 既存の操作ボタン（ツリー切り替えなど）をBottomNavigationへ移行。
- [ ] 案内メッセージ（「ノードをタップして...」）の折り返し防止スタイル調整。

### Phase 2: リサーチ機能強化 (Full Stack)
- [ ] **Backend**: `addResearchResult` APIエンドポイントの実装（または既存更新）。
- [ ] **Frontend**: `ResearchPanel` に手動追加フォーム（モーダルまたはインライン）を追加。
- [ ] **Frontend**: 追加データの送信処理とState更新。

### Phase 3: インフラ・認証 (Infrastructure/Auth)
- [ ] **Auth**: 本番環境でのGoogleログイン不具合の原因調査と修正。
- [ ] **Config**: 本番用環境変数（Firebase Config）の管理方法調査と実装（`.env` ファイルの使い分け等）。

## 検証計画
- モバイルビュー（Chrome DevTools）での表示確認。
- 実機（Android TWA）での操作確認。
- リサーチ結果手動追加後のデータ永続化確認。
