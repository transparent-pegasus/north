# 実装計画: ツリー同期処理とUI品質の改善

## 概要
ユーザーからのフィードバックに基づき、ツリー操作時の同期不良や表示上のバグを修正し、特にモバイル環境でのUXを向上させる。

## タスクリスト

### 1. ツリー独立（Promote）時のリスト更新不具合の修正
- [x] `api/promote` 成功時に、即座にツリー一覧（`treeIndex`）を再取得するロジックを実装する
- [x] 新しいツリーIDへ自動的に切り替わるよう、`ControlPanel` からのコールバック連携を改善する
- [x] `page.tsx` に `handleTreePromoted` 関数を実装し、一連のフローを制御する

### 2. 要素更新後のメニュー表示不具合の修正
- [x] `selectedNode` の同期ロジックにおいて、`tree.goal` との同期時に `type` プロパティが欠落する問題を修正する
- [x] `type` が失われることで「リサーチ」や「削除」メニューが非表示になるバグを解消する

### 3. モバイルロード時の表示改善
- [x] `TreeList` コンポーネントに対し、ツリー詳細だけでなく「ツリー一覧」の取得中状態も伝播させる
- [x] まだツリー一覧が取得できていない初期ロード時に、空の状態（追加ボタン）が表示されてしまうちらつきを防止する

### 4. 入力欄の表示バグ修正
- [x] `ControlPanel` の入力欄において、`condition` や `currentState` がオブジェクトとして渡された場合に `[object Object]` と表示される問題を修正する
- [x] オブジェクトの場合は `.content` プロパティを展開して表示するように変更する
- [x] `ControlPanelProps` の型定義を更新し、`content` プロパティを許容する
